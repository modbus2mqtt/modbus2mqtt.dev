#/bin/sh
set -e
echo DOCKER_GID=$(getent group docker| cut -d: -f 3)>.devcontainer/.env
REMOTE_UID=$(id| sed -e "s/uid=\([0-9]*\).*/\1/g")
cp .devcontainer/Dockerfile  .devcontainer/Dockerfile.bck 
xhost local:root
if [ $REMOTE_UID -ne 1000 ]
then
    sed -e "s/ARG REMOTE_UID.*/ARG REMOTE_UID=$REMOTE_UID/g"|
    sed -e "s/ARG REMOTE_USER.*/ARG REMOTE_USER=remoteuser/g" <.devcontainer/Dockerfile.bck >.devcontainer/Dockerfile
else     
    sed -e "s/ARG REMOTE_UID.*/ARG REMOTE_UID=1000/g" <.devcontainer/Dockerfile.bck |
    sed -e "s/ARG REMOTE_USER.*/ARG REMOTE_USER=node/g" >.devcontainer/Dockerfile
fi
rm .devcontainer/Dockerfile.bck
